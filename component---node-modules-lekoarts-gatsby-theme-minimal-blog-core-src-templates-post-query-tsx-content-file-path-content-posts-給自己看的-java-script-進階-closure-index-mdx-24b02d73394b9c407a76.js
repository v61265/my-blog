"use strict";(self.webpackChunkv61265_blog=self.webpackChunkv61265_blog||[]).push([[87],{1173:function(e,n,t){t.d(n,{p:function(){return p},A:function(){return E}});var l=t(6540),a=t(557),r=t(6835),c=t(3328),o=t(7715),i=t(7169);var m=e=>{let{post:n}=e;return null};const u=["16px","8px","4px"].map((e=>"rgba(0, 0, 0, 0.1) 0px "+e+" "+e+" 0px"));var s=e=>{let{data:{post:n},children:t}=e;return(0,a.Y)(c.A,null,(0,a.Y)(r.DZ,{as:"h1",variant:"styles.h1"},n.title),(0,a.Y)("p",{sx:{color:"secondary",mt:3,a:{color:"secondary"},fontSize:[1,1,2]}},(0,a.Y)("time",null,n.date),n.tags&&(0,a.Y)(l.Fragment,null," — ",(0,a.Y)(o.A,{tags:n.tags})),n.timeToRead&&" — ",n.timeToRead&&(0,a.Y)("span",null,n.timeToRead," min read")),(0,a.Y)("section",{sx:{my:5,".gatsby-resp-image-wrapper":{my:[4,4,5],borderRadius:"4px",boxShadow:u.join(", "),".gatsby-resp-image-image":{borderRadius:"4px"}},variant:"layout.content"}},t),(0,a.Y)(m,{post:n}))};const p=e=>{var n,t,l;let{data:{post:r}}=e;return(0,a.Y)(i.A,{title:r.title,description:r.description?r.description:r.excerpt,image:r.banner?null===(n=r.banner)||void 0===n||null===(t=n.childImageSharp)||void 0===t||null===(l=t.resize)||void 0===l?void 0:l.src:void 0,pathname:r.slug,canonicalUrl:r.canonicalUrl})};function E(e){let{...n}=e;return l.createElement(s,n)}},7715:function(e,n,t){var l=t(557),a=t(6540),r=t(4194),c=t(3601),o=t(2174);n.A=e=>{let{tags:n}=e;const{tagsPath:t,basePath:i}=(0,c.A)();return(0,l.Y)(a.Fragment,null,n.map(((e,n)=>(0,l.Y)(a.Fragment,{key:e.slug},!!n&&", ",(0,l.Y)(r.Link,{sx:e=>{var n;return{...null===(n=e.styles)||void 0===n?void 0:n.a}},to:(0,o.A)("/"+i+"/"+t+"/"+e.slug)},e.name)))))}},7169:function(e,n,t){var l=t(6540),a=t(4194),r=t(7533);n.A=e=>{let{title:n="",description:t="",pathname:c="",image:o="",children:i=null,canonicalUrl:m=""}=e;const u=(0,r.A)(),{siteTitle:s,siteTitleAlt:p,siteUrl:E,siteDescription:g,siteImage:d,author:f,siteLanguage:h}=u,C={title:n?n+" | "+s:p,description:t||g,url:""+E+(c||""),image:""+E+(o||d)};return l.createElement(l.Fragment,null,l.createElement("html",{lang:h}),l.createElement("title",null,C.title),l.createElement("meta",{name:"description",content:C.description}),l.createElement("meta",{name:"image",content:C.image}),l.createElement("meta",{property:"og:title",content:C.title}),l.createElement("meta",{property:"og:url",content:C.url}),l.createElement("meta",{property:"og:description",content:C.description}),l.createElement("meta",{property:"og:image",content:C.image}),l.createElement("meta",{property:"og:type",content:"website"}),l.createElement("meta",{property:"og:image:alt",content:C.description}),l.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),l.createElement("meta",{name:"twitter:title",content:C.title}),l.createElement("meta",{name:"twitter:url",content:C.url}),l.createElement("meta",{name:"twitter:description",content:C.description}),l.createElement("meta",{name:"twitter:image",content:C.image}),l.createElement("meta",{name:"twitter:image:alt",content:C.description}),l.createElement("meta",{name:"twitter:creator",content:f}),l.createElement("meta",{name:"gatsby-theme",content:"@lekoarts/gatsby-theme-minimal-blog"}),l.createElement("link",{rel:"icon",type:"image/png",sizes:"32x32",href:(0,a.withPrefix)("/favicon-32x32.png")}),l.createElement("link",{rel:"icon",type:"image/png",sizes:"16x16",href:(0,a.withPrefix)("/favicon-16x16.png")}),l.createElement("link",{rel:"apple-touch-icon",sizes:"180x180",href:(0,a.withPrefix)("/apple-touch-icon.png")}),m?l.createElement("link",{rel:"canonical",href:m}):null,i)}},2034:function(e,n,t){t.r(n),t.d(n,{Head:function(){return o.p},default:function(){return i}});var l=t(6540),a=t(8453);function r(e){const n=Object.assign({p:"p",a:"a",h2:"h2",pre:"pre",code:"code",h4:"h4",strong:"strong"},(0,a.RP)(),e.components);return l.createElement(l.Fragment,null,l.createElement(n.p,null,"給自己看的 JS 進階：（建議按照順序看）\n",l.createElement(n.a,{href:"/JavaScript-advanced-variable"},"給自己看的 JS 進階－變數"),"\n",l.createElement(n.a,{href:"/JavaScript-advanced-hoisting"},"給自己看的 JS 進階－Hoisting"),"\n",l.createElement(n.a,{href:"/JavaScript-advanced-closure"},"給自己看的 JS 進階－Closure"),"\n",l.createElement(n.a,{href:"JavaScript-advanced-oop"},"給自己看的 JS 進階－物件導向")),"\n",l.createElement(n.h2,null,"Closure 閉包"),"\n",l.createElement(n.p,null,"先看一個例子："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"function test() {\n\tvar a = 10\n\tfunction inner() {\n\t\ta++\n\t\tconsole.log(a)\n\t}\n\treturn inner // 回傳 inner 這個函數\n}\n\nvar func = test()\nfanc() // 也就是 inner()， 11\nfanc() 12\nfanc() 13\n")),"\n",l.createElement(n.p,null,"所謂 ",l.createElement(n.code,null,"Closure 閉包")," 就是像這樣，在一個 function 中 return 一個 function 。當我們呼叫裡面的 function 時，裡面的 function 會將外面 finction 的值記起來並鎖在裡面，因此稱為閉包。"),"\n",l.createElement(n.p,null,"如果我們希望能記住上次計算的值，不用再算一次，就可以使用閉包，例如："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"function complex(n) {\n  // 複雜計算\n  console.log('caculate');\n  return n * n;\n}\n\nfunction cache(func) {\n  var ans = {};\n  return function (num) {\n    if (ans[num]) {\n      // 如果有紀錄就直接回傳值\n      return ans[num];\n    }\n\n    ans[num] = func(num);\n    return ans[num];\n  };\n}\n\nconst cacheComplex = cache(complex);\nconsole.log(cacheComplex(20)); // caculate 400\nconsole.log(cacheComplex(20)); // 400\nconsole.log(cacheComplex(20)); // 400\n")),"\n",l.createElement(n.p,null,"只要算過一次 ",l.createElement(n.code,null,"ans[num]")," 就會被記起來，之後就都不用再跑一次 complex 了。"),"\n",l.createElement(n.h4,null,"Closure ㄉ原理"),"\n",l.createElement(n.p,null,"ECMAScript ES3 版本中有提到，每個 CE 都有一個 ",l.createElement(n.code,null,"Scope Chain")," ，進入 EC 時， ",l.createElement(n.code,null,"Scope Chain")," 被初始化為 ",l.createElement(n.code,null,"Activation Object")," （其實就是 function 中的 ",l.createElement(n.code,null,"VO"),"） 和 ",l.createElement(n.code,null,"[[scope]]"),"。"),"\n",l.createElement(n.p,null,"看一個簡單的例子："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"var a = 1;\nfunction test() {\n  var b = 2;\n  function inner() {\n    var c = 3;\n    console.log(a); // 1\n    console.log(b); // 2\n  }\n  inner();\n}\n\ntest();\n")),"\n",l.createElement(n.p,null,"此時底層的狀態是："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"Global EC: {\n\tVO: {\n\t\ta: undefined,\n\t\ttest:func\n\t},\n\tscopeChain: [Global VO]\n}\n\n// 初始化一下\ntest.[[Scope]] = globalEC.scopeChain // [Global.VO]\n")),"\n",l.createElement(n.p,null,"進到 testEC 之後如下："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"test EC: {\n\tAO: {\n\t\tb: undefined,\n\t\tinner: func\n\t},\n\tscopeChain: [testEC.AO, test.[[Scope]]]\n\t// 看上一格，也就是 [testEC.AO, globalEC.scopeChain]\n\t// 也就是 [testEC.AO, Global.VO]\n}\n\n// 初始化一下\nINNER.[[Scope]] = testEC.scopeChain // [testEC.AO, Global.VO]\n\nGlobal EC: {\n\tVO: {\n\t\ta: 1,\n\t\ttest: func\n\t},\n\tscopeChain: [Global.VO]\n}\n")),"\n",l.createElement(n.p,null,"最後進入 innerEC："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"inner EC: {\n\tAO: {\n\t\tc: undefined,\n\t},\n\tscopeChain: [innerEC.AO, inner.[[Scope]]]\n\t// 也就是 [innerEC.AO, testEC.AO, Global.VO]\n}\n\ntest EC: {\n\tAO: {\n\t\tb: 2,\n\t\tinner: func\n\t},\n\tscopeChain: [testEC.AO, test.[[Scope]]]\n\t// 也就是 [testEC.AO, Global.VO]\n}\n\nGlobal EC: {\n\tVO: {\n\t\ta: 1,\n\t\ttest: func\n\t},\n\tscopeChain: [Global.VO]\n}\n")),"\n",l.createElement(n.p,null,"此時回到一開始的例子："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"function test() {\n  var a = 10;\n  function inner() {\n    a++;\n    console.log(a);\n  }\n  return inner; // 回傳 inner 這個函數\n}\n\nvar func = test();\nfanc(); // 也就是 inner()\n")),"\n",l.createElement(n.p,null,"最後一行執行時 ",l.createElement(n.code,null,"test EC")," 已經結束，本來底層機制應該要全部拿掉，但因為 ",l.createElement(n.code,null,"innerEC.scopeChain")," 是 ",l.createElement(n.code,null,"[innerEC.AO, testEC.AO, Global.VO]")," ，因此 ",l.createElement(n.code,null,"testEC.AO")," 還不能那麼快退場。這就是為什麼 inner 可以拿到上一層變數值並儲存更改的原因。"),"\n",l.createElement(n.p,null,"不過偶爾閉包也會產生一些問題，例如外層包了超大的物件，就算之後只使用內層，因為關聯外層的 AO ，那個超大物件就無法被回收。"),"\n",l.createElement(n.h4,null,"Closure 的小陷阱"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"var arr = [];\nfor (var i = 0; i < 5; i++) {\n  arr[i] = function () {\n    console.log(i);\n  };\n}\n\narr[0]();\n")),"\n",l.createElement(n.p,null,"本來預期會得到一到五，結果出來卻只有 5 。"),"\n",l.createElement(n.p,null,"此處的 i 是一個 global 的變數，當我們呼叫 ",l.createElement(n.code,null,"arr[0]()")," 時，是進到 for 迴圈中拿函數，因此函數中的 scope chain 會連動到 global 的 AO ，呼叫時 for 迴圈已經跑完，所以 ",l.createElement(n.code,null,"global.VO")," 中 i 的值是 5 ，延用該 VO 的函數自然而然會輸出 5 。"),"\n",l.createElement(n.p,null,l.createElement(n.strong,null,"解決方法：")),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"function logN(n) {\n  // 閉包的概念\n  return function () {\n    console.log(n);\n  };\n}\n\nconst log2 = logN(2);\nlog2(); // 2\n\nvar arr = [];\nfor (var i = 0; i < 5; i++) {\n  arr[i] = logN(i);\n}\n\narr[0](); // 0\n")),"\n",l.createElement(n.p,null,"因為 ",l.createElement(n.code,null,"arr[i]")," 會迴傳一個新的 function ，因此會產生新的作用域去記住傳入的值。"),"\n",l.createElement(n.p,null,"也可以使用 ",l.createElement(n.code,null,"IIFE")," ，也就是立即呼叫函式，例如："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"(() => {\n  console.log(123);\n})(); // 立刻執行，輸出 123\n")),"\n",l.createElement(n.p,null,"回到剛剛的問題，我們也可以把剛剛的函式 ",l.createElement(n.code,null,"logN")," 放進去："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"var arr = [];\nfor (var i = 0; i < 5; i++) {\n  arr[i] = (function (num) {\n    return function () {\n      console.log(num);\n    };\n  })(i);\n}\n\narr[0](); // 0\n")),"\n",l.createElement(n.p,null,"也可以直接這樣寫："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"var arr = [];\nfor (let i = 0; i < 5; i++) {\n  arr[i] = function () {\n    console.log(i);\n  };\n}\n\narr[0]();\n")),"\n",l.createElement(n.p,null,"因為 ",l.createElement(n.code,null,"let")," 的作用域只存在 block 中，迴圈等於是跑了五個 block ",l.createElement(n.code,null,"arr[i] = function() { console.log(i) }")," ，每一圈都有自己的作用域，所以呼叫 ",l.createElement(n.code,null,"arr[0]")," 時自然就找到印出 0 的函數。"),"\n",l.createElement(n.h4,null,"Closure 的範例"),"\n",l.createElement(n.p,null,"Closure 隱藏資訊不被額外操控的時候很好用，例如："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"var money = 99;\n\nfunction add(num) {\n  money += num;\n}\n\nfunction deduct(mun) {\n  money -= num;\n}\n\nadd(1);\ndeduct(10);\nconsole.log(money); // 90\n\n// 這時你同事很壞，加了一行\nmoney -= 90;\n// 就算繞過任何操作還是可以改變 money 的值\n")),"\n",l.createElement(n.p,null,"此時就可以使用 Closure："),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"function createWallet(init) {\n\tvar money = init\n\treturn {\n\t\tadd: function(num) {\n\t\t\tmoney += num\n\t\t},\n\t\tdeduct: function(num) {\n\t\t\tmoney -= num\n\t\t}\n\t}, getMoney() {\n\t\treturn money\n\t}\n}\n\nvar myWallet = createWallet(99)\nmyWallet.add(1)\nmyWallet.deduct(10)\nconsole.log(myWallet.getMoney()) // 90\n")))}var c=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,a.RP)(),e.components);return n?l.createElement(n,e,l.createElement(r,e)):r(e)},o=t(1173);function i(e){return l.createElement(o.A,e,l.createElement(c,e))}o.A}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-給自己看的-java-script-進階-closure-index-mdx-24b02d73394b9c407a76.js.map